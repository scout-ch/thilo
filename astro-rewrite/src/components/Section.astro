---
import MarkdownRenderer from './MarkdownRenderer.astro';
import type { SectionT } from '../utils/data';

export interface Props {
  section: SectionT;
}

const { section } = Astro.props;
---

<div class="content">
  <div id="section-title" class="section-title mb-2" style={`background-color: ${section.color_primary || '#0066cc'}`}>
    <h1 class="bg-primary px-2">{section.title}</h1>
  </div>

  <div class="section-body rounded p-2 color-bg-default">
    <div class="section-description">
      <MarkdownRenderer content={section.content} />
    </div>

    {section.chapters && section.chapters.length > 0 && (
      <div class="chapters">
        {section.chapters
          .sort((a, b) => (a.sorting || 0) - (b.sorting || 0))
          .map(chapter => (
          <div id={chapter.slug} class="chapter">
            <h2>{chapter.title}</h2>
            <div class="chapter-content">
              <MarkdownRenderer content={chapter.content} />
            </div>
            
            {chapter.targets && chapter.targets.length > 0 && (
              <div class="targets">
                <h3>Zielgruppe</h3>
                <div class="targets-list">
                  {chapter.targets.map(target => (
                    <div class="target-item">
                      <span class="target-role">{target.role}</span>
                      <h4>{target.title}</h4>
                      <MarkdownRenderer content={target.content} />
                    </div>
                  ))}
                </div>
              </div>
            )}
          </div>
        ))}
      </div>
    )}
  </div>

  <!-- Back to top button -->
  <button 
    id="back-to-top" 
    class="back-to-top" 
    onclick="document.getElementById('section-title')?.scrollIntoView({behavior: 'smooth'})"
    aria-label="Nach oben"
  >
    â†‘ Nach oben
  </button>
</div>



<script>
  // Handle scroll to chapter functionality
  document.addEventListener('DOMContentLoaded', function() {
    // Check if there's a hash in the URL and scroll to it
    const hash = window.location.hash;
    if (hash) {
      const element = document.querySelector(hash);
      if (element) {
        setTimeout(() => {
          element.scrollIntoView({ behavior: 'smooth' });
        }, 100);
      }
    }

    // Show/hide back to top button based on scroll position
    const backToTopButton = document.getElementById('back-to-top');
    if (backToTopButton) {
      window.addEventListener('scroll', function() {
        if (window.scrollY > 300) {
          backToTopButton.style.display = 'block';
        } else {
          backToTopButton.style.display = 'none';
        }
      });

      // Initially hide the button
      backToTopButton.style.display = 'none';
    }
  });
</script>
